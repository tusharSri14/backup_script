#!/bin/bash
# ===============================================
# Automated Backup & Recovery Script
# Author: Tushar srivastava
# Project: Backup & Recovery (Linux Support)
# ===============================================

# ==== CONFIGURATION ====
# Directories to back up
SOURCE_DIRS="/home /etc"

# Local backup destination
BACKUP_DIR="/backup"

# Remote backup (optional)
REMOTE_USER="backupuser"
REMOTE_HOST="192.168.1.100"
REMOTE_DIR="/remote_backup"

# Backup file name (with date)
DATE=$(date +%F_%H-%M-%S)
BACKUP_FILE="backup_${DATE}.tar.gz"

# ==== SCRIPT START ====

# 1. Ensure backup directory exists
mkdir -p "$BACKUP_DIR"

# 2. Create compressed backup
echo "üì¶ Creating backup..."
tar -czf "$BACKUP_DIR/$BACKUP_FILE" $SOURCE_DIRS
if [ $? -eq 0 ]; then
    echo "‚úÖ Backup created: $BACKUP_DIR/$BACKUP_FILE"
else
    echo "‚ùå Backup failed!"
    exit 1
fi

# 3. Copy backup to remote server using rsync
echo "üåê Transferring backup to remote server..."
rsync -avz "$BACKUP_DIR/$BACKUP_FILE" "$REMOTE_USER@$REMOTE_HOST:$REMOTE_DIR"

if [ $? -eq 0 ]; then
    echo "‚úÖ Remote backup successful: $REMOTE_HOST:$REMOTE_DIR/$BACKUP_FILE"
else
    echo "‚ö†Ô∏è Remote backup failed. Check connection or credentials."
fi

# 4. Optional: Keep only last 7 backups (cleanup old files)
echo "üßπ Cleaning old backups (keeping last 7)..."
ls -1t "$BACKUP_DIR"/backup_*.tar.gz | tail -n +8 | xargs -r rm -f

echo "üéâ Backup process completed!"

